import{h as H,c as a,o as r,a as _,n as b,d as c,p as m,F as x,k as B,u as L,w as A,b as o,q as D,t as i}from"./index-BjBpr3Ih.js";import{u as N}from"./history-CaRsatYm.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as l}from"./function-call-D_8_aYSs.js";import"./index-ngrFHoWO.js";import"./user-D0w_HHS9.js";import"./api-Cct3C2HD.js";import"./mount-component-LTm6VdL5.js";const S={class:"history-container"},T={key:0,class:"history-list"},V={class:"news-item"},$={key:0,class:"news-image"},F=["src","alt"],P={class:"news-info"},R={class:"news-title"},q={class:"news-meta"},z={__name:"History",setup(E){const d=L(),n=N(),u=()=>{d.back()},p=s=>{d.push(`/news/detail/${s}`)},y=async s=>{try{const t=await n.removeHistoryApi(s);console.log("删除单条历史记录结果:",t),!t.success&&!t.isLocal&&l({title:"提示",message:t.message||"删除失败，请稍后重试"})}catch(t){console.error("删除历史记录失败:",t)}},h=s=>{l({title:"提示",message:"确定要删除这条浏览记录吗？",showCancelButton:!0}).then(t=>{t==="confirm"&&y(s)})},v=async()=>{l({title:"提示",message:"确定要清空所有浏览历史吗？",showCancelButton:!0}).then(async s=>{if(s==="confirm")try{const t=await n.clearHistoryApi();console.log("清空历史记录结果:",t),!t.success&&!t.isLocal&&l({title:"提示",message:t.message||"清空失败，请稍后重试"})}catch(t){console.error("清空历史记录失败:",t)}})};return H(async()=>{try{const s=await n.getHistoryListApi();console.log("浏览历史页面：API获取结果",s),(!s||!s.success)&&n.loadHistory()}catch(s){console.error("浏览历史页面：API请求异常",s),n.loadHistory()}}),(s,t)=>{const f=c("van-nav-bar"),g=c("van-cell"),k=c("van-button"),w=c("van-empty");return r(),a("div",S,[_(f,{title:"浏览历史","left-text":"返回","left-arrow":"",onClickLeft:u,"right-text":"清空",onClickRight:v,fixed:""}),m(n).getHistory.length?(r(),a("div",T,[(r(!0),a(x,null,B(m(n).getHistory,e=>(r(),a("div",{class:"history-item",key:e.id},[_(g,{onClick:C=>p(e.id),border:!1},{title:A(()=>[o("div",V,[e.image?(r(),a("div",$,[o("img",{src:e.image,alt:e.title},null,8,F)])):D("",!0),o("div",P,[o("div",R,i(e.title),1),o("div",q,[o("span",null,i(e.author),1),o("span",null,i(e.publishTime),1),o("span",null,"浏览时间: "+i(e.viewTime),1)])])])]),_:2},1032,["onClick"]),_(k,{class:"delete-btn",type:"danger",size:"mini",icon:"cross",onClick:C=>h(e.id)},null,8,["onClick"])]))),128))])):(r(),b(w,{key:1,description:"暂无浏览历史"}))])}}},W=I(z,[["__scopeId","data-v-5af02ed7"]]);export{W as default};
